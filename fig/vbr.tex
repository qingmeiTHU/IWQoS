\begin{eqnarray}
& maximize & \sum R_j- \alpha\sum |R_{j+1}-R_j|-\beta\sum D_j
\label{vbr-formulation} \mylabel{vbr-formulation}
\end{eqnarray}
\\ subject to
\begin{eqnarray}
% \nonumber % Remove numbering (before each equation)
&& R_{j+1}=R_j, \forall j\not\equiv M-1 (\text{mod}M) \label{vbr-bitrate}\\
&& S_j = argmax{\sum_k R_k^j*T_k^j \leq C_j}, \forall j \label{vbr-send} \\
&& F_j = sgn(\sum_{S_j+1} T_k^j - (C_j- \sum_k R_k^j*T_k^j)/R_{S_j+1}^j), \forall j \label{vbr-drop}\\
&& D_j = F_j*(C_j- \sum_{S_j} R_k^j*T_k^j)/R_{S_j+1}^j), \forall j \label{vbr-drop-no} \\
&& N_{j+1}=N_j-S_j-F_j+1-sgn(j\%M), \forall j \label{vbr-gop-no}\\
&& R_k^{j+1}=R_{k+S_j+F_j}^j, \forall j, k\in \{1,N_j-S_j-F_j\} \label{vbr-bitrate-next}\\
&& R_{N_j-S_j-F_j+1}^{j+1} = R_{j+1}, \forall j \equiv 0(\text{mod}M) \label{vbr-bitrate-spec} \\
&& T_k^{j+1} = T_{k+S_j+F_j}^j, \forall j, k\in\{1, N_j-S_j-F_j\} \label{vbr-time-next} \\
&& T_{N_j-S_j-F_j}^{j+1} = T_{N_j-S_j-F_j}^{j+1} + sgn(j\%M*F_j), \forall j \label{vbr-time-spec}\\
&& T_{N_j-S_j-F_j+1}^{j+1}=1, \forall j\equiv 0 {\text{mod}M} \label{vbr-time-spec2} \\
\end{eqnarray}
